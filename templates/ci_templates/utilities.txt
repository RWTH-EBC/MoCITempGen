# conda_environment: ${conda_environment}
# modelica_py_ci_url: ${modelica_py_ci_url}
# ci_toml_path: ${ci_toml_path}

# This file contains small scripts, rules or other templates
# which can be referenced by other templates in this repo (or other repos as well).
# Include the scripts using the `!reference` tag.

.github_ssh_auth:
  script:
    - 'which ssh-agent || ( apt-get update -y && apt-get install openssh-client -y )'
    - eval $(ssh-agent -s)
    - mkdir -p ~/.ssh
    - ssh-keyscan github.com >> ~/.ssh/known_hosts
    - ssh-agent -a /tmp/ssh_agent.sock > /dev/null
    - echo "$GITHUB_PRIVATE_KEY" > ~/.ssh/id_rsa
    - chmod 600 ~/.ssh/id_rsa
    - git config --global user.name "$GITLAB_USER_NAME"
    - git config --global user.email "$GITLAB_USER_EMAIL"

.clone_ci_templates:
  script:
    - export PIP_CACHE_DIR="/opt/cache/pip"
    - source activate ${conda_environment} || echo "${conda_environment} is not installed, can't activate it"
    - pip install --upgrade pip && pip install natsort toml pandas mako requests
    - export PYTHONIOENCODING=utf-8
    - pip install git+https://github.com/lbl-srg/BuildingsPy.git@master
    - pip install git+${modelica_py_ci_url}
    - export CI_PYTHON_CONFIG_FILE="${ci_toml_path}"

.custom_install_additional_modelica_libraries:
  script:
    - echo "Skipping custom installation of other Modelica libraries"

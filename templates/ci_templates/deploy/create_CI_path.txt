include: '${utilities_directory}'

stages:
    - ${ci_stage_build_ci_structure}
    
create_ci_structure_job:
    stage: ${ci_stage_build_ci_structure}
    before_script:
        - !reference [.clone_ci_templates, script]
        - !reference [.github_ssh_auth, script]

    script:
        - git clone --single-branch --branch $CI_COMMIT_REF_NAME git@github.com:$Github_Repository.git
        - cd $CI_PROJECT_NAME
        - python ../MoCITempGen/CITests/CleanUp/structure_check.py
    after_script:
        - cd $CI_PROJECT_NAME
        - message="${bot_create_structure_commit}" ;
        - git add /dymola-ci-tests ;
        - git commit -m "$message";
        - git push git@github.com:$Github_Repository.git ;
           
    only:
        variables:
        - $CI_COMMIT_MESSAGE  =~/${ci_build_structure_commit}/
    retry:
        max: 2
        when: runner_system_failure  
    artifacts:
        when: on_failure
        paths:
            - ${wh_model_file}
            - ${wh_html_file}
            - ${ci_interact_show_ref_file}
            - ${ci_interact_update_ref_file}
            - ${wh_ref_file}
        expire_in: ${expire_in_time}
    